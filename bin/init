#!/bin/bash

# init script
#
# This script cleans up and prepares the repo for your project, then builds the site.
#
# WARNING: Only run this once! Running again will delete your .git and start you over
#          from scratch. If you want to rebuild the site again, run build instead.
#
# FLAG OPTIONS
#
# -webroot somevalue
#   The default webroot is 'www' but you can specifiy a different directory if
#   desired.

cd $(git rev-parse --show-toplevel)
PATH=$PWD/bin:$PATH

# Grab the command flags passed as arguments
options=$@
arguments=($options)
index=0

# Set flag defaults
webroot="webroot"

# Set passed flags
for argument in $options
  do
    # Incrementing index
    index=`expr $index + 1`

    # The conditions
    case $argument in
      -webroot)
        webroot=${arguments[index]} ;;
    esac
done

# Remove the .git folder created by the clone and reinitialize Git
rm -rf .git
git init

# Do the initial commit
git add -A
git commit -m "Initial commit."

# Build the Drupal site
./bin/build -webroot=${webroot}

# Remind users to update their .gitignore if they used a non-default webroot path
echo "IMPORTANT: If you used a webroot other then the default, make sure to edit .gitignore and change the webroot."
